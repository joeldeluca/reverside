<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"/>
  <title>REVERside — iOSX DIAG v12</title>
  <style>
    html,body{margin:0;padding:0;background:#eef2f7;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    #diagBanner{
      position:fixed;left:0;right:0;top:0;z-index:999999;
      background:#b00020;color:#fff;
      padding:10px 12px;
      font-weight:800;
      letter-spacing:.4px;
      text-align:center;
      box-shadow:0 8px 20px rgba(0,0,0,.25);
    }
    #diagBox{
      position:fixed;left:10px;right:10px;bottom:10px;z-index:999999;
      background:rgba(0,0,0,.82);color:#fff;border-radius:12px;
      padding:12px 12px;
      font-size:13px;line-height:1.35;
      max-height:42vh;overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    #diagBox b{color:#9be7ff;}
    #diagBox .err{color:#ffb3b3;}
    #diagBox .ok{color:#b8ffb8;}
    #diagBox .warn{color:#ffe6a6;}
    #main{padding-top:56px;}
    .btn{display:inline-block;margin:6px 6px 0 0;padding:8px 10px;border-radius:10px;background:#0b1d3a;color:#fff;font-weight:700}
    .note{padding:14px;color:#0b1d3a}
    code{background:#fff;padding:2px 5px;border-radius:6px}
  </style>

  <script>
  (function(){
    function $(id){ return document.getElementById(id); }
    function now(){ try{ return (new Date()).toISOString(); }catch(e){ return ""; } }
    function append(line, cls){
      var box = $("diagLines");
      if(!box) return;
      var div = document.createElement("div");
      if(cls) div.className = cls;
      div.textContent = line;
      box.appendChild(div);
      // Keep last 200 lines
      while(box.childNodes.length > 200){ box.removeChild(box.firstChild); }
    }

    // Always visible "proof" that THIS file is loaded:
    document.addEventListener("DOMContentLoaded", function(){
      var stamp = $("diagStamp");
      if(stamp) stamp.textContent = "DIAG v12 — " + now();
      append("DOM ready ✓", "ok");
      append("UA: " + (navigator.userAgent || "n/a"), "");
      append("URL: " + (location.href || "n/a"), "");
      append("online: " + (navigator.onLine ? "true" : "false"), "");
      // WebGL probe
      try{
        var c = document.createElement("canvas");
        var gl = c.getContext("webgl") || c.getContext("experimental-webgl");
        if(gl){
          append("WebGL context: OK", "ok");
          try{
            var dbg = gl.getExtension("WEBGL_debug_renderer_info");
            if(dbg){
              append("GPU: " + gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL), "");
              append("Vendor: " + gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL), "");
            }else{
              append("WEBGL_debug_renderer_info: not available", "warn");
            }
          }catch(e2){
            append("GPU query failed: " + (e2 && e2.message ? e2.message : e2), "warn");
          }
          try{ append("MAX_TEXTURE_SIZE=" + gl.getParameter(gl.MAX_TEXTURE_SIZE), ""); }catch(e3){}
          try{ append("MAX_RENDERBUFFER_SIZE=" + gl.getParameter(gl.MAX_RENDERBUFFER_SIZE), ""); }catch(e4){}
        }else{
          append("WebGL context: FAILED (null)", "err");
        }
      }catch(e){
        append("WebGL probe exception: " + (e && e.message ? e.message : e), "err");
      }

      // THREE probe (local path)
      append("Loading three.min.js…", "");
      var s = document.createElement("script");
      s.src = "../three.min.js?v=diag12";
      s.onload = function(){
        append("three.min.js loaded ✓", "ok");
        append("THREE present: " + (window.THREE ? "YES" : "NO"), window.THREE ? "ok" : "err");
        if(window.THREE){
          try{
            append("THREE.REVISION=" + (window.THREE.REVISION || "n/a"), "");
          }catch(e){}
        }
      };
      s.onerror = function(){
        append("three.min.js FAILED to load (../three.min.js)", "err");
      };
      document.head.appendChild(s);
    });

    window.onerror = function(msg, src, line, col, err){
      append("onerror: " + msg + " @ " + src + ":" + line + ":" + col, "err");
      if(err && err.stack) append("stack: " + err.stack, "err");
      return false;
    };
    window.onunhandledrejection = function(ev){
      var r = ev && ev.reason ? ev.reason : ev;
      var txt = "";
      try{ txt = (r && r.message) ? r.message : (""+r); }catch(e){ txt = "unhandledrejection"; }
      append("unhandledrejection: " + txt, "err");
    };
  })();
  </script>
</head>

<body>
  <div id="diagBanner">REVERside — iOSX DIAGNOSTIC <span id="diagStamp">DIAG v12</span></div>

  <div id="main">
    <div class="note">
      Si tu <b>ne vois pas ce bandeau rouge</b>, alors ce n’est pas ce fichier qui est servi (cache, mauvais push, mauvais chemin).
      <div style="margin-top:10px">
        <span class="btn">But: obtenir une erreur lisible</span>
        <span class="btn">et confirmer WebGL + THREE</span>
      </div>
      <div style="margin-top:10px">Chemin attendu: <code>/reverside/iphone5j_ui/play.html?v=diag12</code></div>
    </div>
  </div>

  <div id="diagBox">
    <div><b>Console iPhone</b> (copie la photo de cette zone)</div>
    <div id="diagLines" style="margin-top:8px;"></div>
  </div>

  <noscript>
    <div style="position:fixed;left:10px;right:10px;top:70px;background:#fff3cd;color:#5a4b00;padding:12px;border-radius:12px;z-index:999999;">
      JavaScript est désactivé — le jeu ne peut pas démarrer.
    </div>
  </noscript>
</body>
</html>
